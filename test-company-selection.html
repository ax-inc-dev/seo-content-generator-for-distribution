<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>企業選択テスト</title>
</head>
<body>
  <h1>企業データ選択テスト</h1>
  <button id="testBtn">テスト実行（5回）</button>
  <pre id="results"></pre>

  <script type="module">
    import { companyDataService } from './services/companyDataService.js';

    document.getElementById('testBtn').addEventListener('click', async () => {
      const results = document.getElementById('results');
      results.textContent = 'テスト実行中...\n\n';

      const testKeywords = [
        'AI 研修',
        'AI 活用',
        '生成AI 導入',
        'ChatGPT 業務改善',
        'AI 自動化'
      ];

      for (const keyword of testKeywords) {
        results.textContent += `\n========== キーワード: "${keyword}" ==========\n`;

        // 3回実行して選択される企業を確認
        for (let i = 1; i <= 3; i++) {
          results.textContent += `\n試行 ${i}:\n`;

          try {
            // データ取得
            const allData = await companyDataService.fetchCompanyData();
            results.textContent += `  全データ: ${allData.length}件\n`;
            results.textContent += `  企業リスト: ${allData.map(d => d.company).join(', ')}\n`;

            // キーワード検索
            const selected = companyDataService.searchRelevantData(keyword, allData);
            results.textContent += `  選択された企業: ${selected.map(d => d.company).join(', ')}\n`;

            // カテゴリ確認
            const categories = selected.map(d => d.industry || '不明');
            results.textContent += `  業界: ${categories.join(', ')}\n`;
          } catch (error) {
            results.textContent += `  エラー: ${error.message}\n`;
          }
        }
      }

      results.textContent += '\n\n===== テスト完了 =====\n';
      results.textContent += '期待される結果:\n';
      results.textContent += '- 6社（グラシズ、Route66、C社、Foxx、WISDOM合同会社、Inmark）が含まれる\n';
      results.textContent += '- 各試行で異なる3社が選ばれることがある\n';
      results.textContent += '- Foxx、WISDOM、Inmarkも選ばれる\n';
    });
  </script>
</body>
</html>